<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>لوحة الأدمن</title>
  <script>
    let loggedIn = false;

    async function loginAdmin() {
      const user = document.getElementById("username").value;
      const pass = document.getElementById("password").value;
      if (user === "admin" && pass === "1234") {
        loggedIn = true;
        document.getElementById("login").style.display = "none";
        document.getElementById("panel").style.display = "block";
        loadUsers();
      } else {
        alert("خطأ في تسجيل الدخول");
      }
    }

    async function addUser() {
      const name = document.getElementById("name").value;
      const phone = document.getElementById("phone").value;
      const days = document.getElementById("days").value;

      const endDate = new Date();
      endDate.setDate(endDate.getDate() + parseInt(days));

      const res = await fetch("/api/users", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          name, phone,
          status: "active",
          endDate: endDate.toISOString()
        })
      });
      const data = await res.json();
      alert(data.message);
      loadUsers();
    }

    async function loadUsers() {
      const res = await fetch("/api/all-users");
      const users = await res.json();
      const list = document.getElementById("users");
      list.innerHTML = "";
      for (let [phone, user] of Object.entries(users)) {
        const li = document.createElement("li");
        li.textContent = `${user.name} - ${phone} - ${user.subscription?.status}`;
        list.appendChild(li);
      }
    }
  </script>
</head>
<body>
  <div id="login">
    <h2>تسجيل دخول الأدمن</h2>
    <input id="username" placeholder="اسم المستخدم"><br>
    <input id="password" type="password" placeholder="كلمة السر"><br>
    <button onclick="loginAdmin()">دخول</button>
  </div>

  <div id="panel" style="display:none">
    <h2>لوحة التحكم</h2>
    <h3>إضافة مستخدم</h3>
    <input id="name" placeholder="الاسم"><br>
    <input id="phone" placeholder="رقم الهاتف"><br>
    <input id="days" placeholder="مدة الاشتراك (بالأيام)"><br>
    <button onclick="addUser()">إضافة</button>

    <h3>قائمة العملاء</h3>
    <ul id="users"></ul>
  </div>
</body>
</html>

    <script src="/js/bootstrap.bundle.min.js"></script>
    <script src="/js/admin.js"></script>
</body>
</html>